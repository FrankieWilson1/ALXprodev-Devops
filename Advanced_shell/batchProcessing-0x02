#!/bin/bash
# Automate the retrieval of data for multiple Pokémon and store it in separate files.

# Define the array of Pokemon names.
pokemon_list=("bulbasaur", "ivysaur", "venusaur", "charmander", "charmeleon")

# Base URL for the API and the output directory.
API_URL="https://pokeapi.co/api/v2/pokemon/"
OUTPUT_DIR="pokemon_data"
MAX_ATTEMPTS=3

# Create the output directory if it doesen't exist.
mkdir -p "$OUTPUT_DIR"

# Loop through each Pokemon in the list.
for pokemon in "${pokemon_list[@]}"; do
    echo "Fetching data for $pokemon..."

    # Initialize retry variables.
    attempts=0
    status=1

    # Convert the name to lowercase for the URL and filename.
    pokemon_lower=$(echo "$pokemon" | tr '[:upper:]' '[:lower:]')

    # Retry loo:
    while [ $status -ne 0 ] && [ $attempts -lt $MAX_ATTEMPTS ]; do
        if [ $attempts -gt 0 ]; then
            echo " Request failed. Retrying attempt $attempts..."
            sleep 2
        fi

        # Make the API request and save the output (Silently)
        curl -sS -o "${OUTPUT_DIR}/${pokemon_lower}.json" "${API_URL}${pokemon_lower}"
        status=$?  # Capture the exit status
        attempts=$((attempts + 1))
    done

    # Check final status after all retries.
    if [ $status -eq 0 ]; then
        echo "Saved data to ${OUTPUT_DIR}/${pokemon_lower}.json ✅"
    else
        echo "Failed to fetch data for $pokemon after $MAX_ATTEMPTs attempts. Skipping. ❌"
    fi
done

echo "Script finished."
